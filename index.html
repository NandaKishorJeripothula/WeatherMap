<html>
    <head>
        <title>Weather Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <style>
        
        #map {
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        </style>
        <script>
            function locate(){
               navigator.geolocation.getCurrentPosition(initialize,fail,{timeout:3000})
            }
            function initialize(position){
                if(position.coords)
                {
                    var currentLocaiton = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                }else{
                    var currentLocaiton = position;
                }
                var mapOptions = {
                    zoom: 7,
                    center: currentLocaiton,
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                };
                var map = new google.maps.Map(document.getElementById('map'),mapOptions);
                var infowindow = new google.maps.InfoWindow();
                    
                var infoMessage="";
                var userMarker = new google.maps.Marker({
                    position: currentLocaiton,
                    map: map,
                });
                getWeather(currentLocaiton);
                google.maps.event.addListener(map, 'click', function(event){
                    createMarker(event.latLng);
                });
                google.maps.event.addListener(userMarker,'click',function(evt){
                    getWeather(evt.latLng);
                });
                function createMarker(location) {
                    if (userMarker == undefined){
                        userMarker = new google.maps.Marker({
                            position: location,
                            map: map, 
                        });
                        getWeather(location);
                        
                    }
                    else{
                        userMarker.setPosition(location);
                        getWeather(location);
                    }
                }
                function getWeather(location){
                    key="449de63838b85f03e45a2616932ed63c";
                    url=`http://api.openweathermap.org/data/2.5/weather?lat=${location.lat()}&lon=${location.lng()}&units=metric&appid=${key}`
                    fetch(url)
                        .then(function(response) {
                            return response.json();
                        })
                        .then(function(data) {
                            var dateObj = new Date(),
                                    month = dateObj.getUTCMonth() + 1, //months from 1-12
                                    day = dateObj.getUTCDate(),
                                    year = dateObj.getUTCFullYear(),
                                    hours =dateObj.getHours(),
                                    minutes =dateObj.getMinutes();
                                    if(hours<12){
                                        minutes= minutes +" AM";
                                        }
                                    else{
                                        hours=hours-12;
                                        minutes=minutes+" PM";
                                    }
                                    // changing accrdng to needs
                                    var d = day + "/" + month + "/" +year + " "+ hours + ":" + minutes;
                            infoMessage = `
                            <div styles={'font-weight':200}>
                                Date & Time : ${d} <br/> <hr>
                                City Name : <b>${data.name}</b> <br/><hr>
                                Weather : <b>${data.weather[0].main}</b><br/>
                                Temaprature : ${data.main.temp} &#176 C <br/>
                                Humidity : ${data.main.humidity} &#176 C <br/>
                            </div>
                            `


                            //'CityName: '+data.name +'<br/> Weather: '+data.weather[0].main+'<br/> Weather Description: '+data.weather[0].description;
                            infowindow.setContent(infoMessage);
                            infowindow.open(map,userMarker);    
                        });
                    
                }
            }
            function fail(){
                alert('navigator.geolocation failed, may not be supported, setting default location');
                    initialize(new google.maps.LatLng(17.4468019, 78.3102378));
            }
        </script>
    </head>
    <body onload="locate()">
       
        <div id="map"></div>
        <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    </body>
</html>